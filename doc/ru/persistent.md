# Описание хранения информации в хранилище
## Для чего нужно хранилище
Хранилище данных о ревизиях нужно для:

 * Сохранение информации об списке измененных файлов (в svn очень часто нужно 
 выяснять, в какой из предыдущих ревизий поменялся файл;
 * Сохранения информации о том, к какой ревизии/ветке относится коммит;
 * Сохранения идентификатора svn-репозитория.

Так же побочным эффектом служит формирование дерева с svn layout-ом для более
простой работы svn update/switch/log/diff и т.п. 

## Формат хранения информации о ревизиях
Для хранения информации о ревизиях используется ссылка `refs/git-as-svn/v2`.
 
Эта ссылка содержит в себе набор коммитов, выстроенных в цеполчку по первому 
родителю. Порядковый номер коммита от начала соответвует номеру ревизии в SVN.

### Содержимое коммита
Данные самого коммита:

 * Первый родитель всегда ссылается на предыдущий коммит;
 * Комментарий коммита берется из оригинального коммита. Именно этот комментарий выводится в svn log;
 * Автор коммита берется из оригинального коммита;
 
Дерево коммита:

 * svn (tree) - дерево, которое соответсвует svn layout-у данного коммита;
 * commit.ref (commit) - ссылка на оригинальный коммит (для коммитов, которые связаны с удалением/созданием веток может отсутствовать);
 * commit.yml (file) - информация о коммите;
  
#### commit.yml
Данный файл сожердит информацию о коммите:

    # Информация о ветке текущего коммита
    branch:
      # Имя ветки в svn
      svn: branches/persistent-cache
      # Имя ветки в git
      git: ref/heads/persistent-cache
    # Информация об изменении файлов в данном коммите
    changes:
    - path: README.md
      kind: FILE
      change: D
      content-modified: true
      property-modified: true
      copy-from:
        path: README.md
        commit: 368c0a94a93f6bf671a2ddfffc7eb34336f64572
    - path: LICENSE
      kind: FILE
      change: A

### Revision 0
Ревизия 0 несколько отличается от остальных коммитов.

В отличие от остальных коммитов:

 * Она всегда содержит путое дерево svn;
 * В ней лежит файл `uuid` с идентификатором репозитория.
